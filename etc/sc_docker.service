[Unit]
Description=Sandcastle Docker (sysbox-runc)
After=network-online.target nss-lookup.target firewalld.service sysbox.service time-set.target
Wants=network-online.target
Requires=sysbox.service
StartLimitBurst=3
StartLimitIntervalSec=60

[Service]
Type=forking
Environment=SANDCASTLE_ROOT=__SANDCASTLE_ROOT__
Environment=SANDCASTLE_DOCKER_PREFIX=__SANDCASTLE_DOCKER_PREFIX__
Environment=SANDCASTLE_BRIDGE_CIDR=__SANDCASTLE_BRIDGE_CIDR__
Environment=SANDCASTLE_FIXED_CIDR=__SANDCASTLE_FIXED_CIDR__
Environment=SANDCASTLE_POOL_BASE=__SANDCASTLE_POOL_BASE__
ExecStart=__BUILD_DIR__/start.sh
ExecStop=__BUILD_DIR__/stop.sh
PIDFile=/run/__SANDCASTLE_DOCKER_PREFIX__docker/dockerd.pid
TimeoutStartSec=60
TimeoutStopSec=30
Restart=on-failure
RestartSec=5

LimitNPROC=infinity
LimitCORE=infinity
LimitNOFILE=infinity
TasksMax=infinity
Delegate=yes
KillMode=process
OOMScoreAdjust=-500

[Install]
WantedBy=multi-user.target
